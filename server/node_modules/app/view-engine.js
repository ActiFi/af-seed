//var swig = require('swig');
//var nunjucks = require('nunjucks-hapi');
var nunjucks = require('express-nunjucks');
var path = require('path');

var config = require('config');

module.exports = function(app){

  var viewDir = path.resolve(config.dirs.root, config.dirs.views);
  console.log('Nunjucks: Init: ', viewDir);

  var noCache = process.env.NODE_ENV === 'development' ? true:false;
  console.log('Nunjucks: caching:', !noCache);


  app.set('view engine', 'html');
  app.set('views', viewDir);

  nunjucks.setup({
    noCache:noCache,
    watch:noCache,
    tags: {
      variableStart: '{$',
      variableEnd: '$}'
    }
  }, app);

  nunjucks.ready(function(env) {
    env.addFilter('json', function (value) {
      return JSON.stringify(value, null, "\t");
    })
  });
};